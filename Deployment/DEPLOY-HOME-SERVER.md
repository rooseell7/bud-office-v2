# BUD Office — ПК як сервер, доступ з різних мереж

Інструкція, як зробити свій ПК доступним з інтернету (домашня мережа, офіс, мобільний інтернет) для роботи з BUD Office.

---

## Огляд

| Компонент | Порт | Роль |
|-----------|------|------|
| Nginx | 80 | Фронтенд, API, WebSocket (проксує все на Backend) |
| Backend | 3000 | REST API + Socket.IO (тільки локально, через Nginx) |

Зовнішній світ бачить тільки порт 80. Backend слухає лише локально (127.0.0.1 через proxy).

---

## 1. Фіксована IP у домашній мережі

Щоб роутер завжди давав ПК той самий внутрішній IP:

1. **Параметри Windows** → **Мережа і Інтернет** → **Wi‑Fi** (або Ethernet) → **Властивості** → знайти **IPv4-адреса** (наприклад `192.168.50.162`).
2. У роутері: **DHCP** → **Резервування адрес** (Static DHCP) — прив’язати MAC-адресу ПК до цієї IP.

Або вручну на ПК:
- **Параметри** → **Мережа** → **Параметри IP** → **Редагувати** → вручну вказати IP, маску, шлюз.

---

## 2. Проброс портів на роутері (Port Forwarding)

Потрібно направити зовнішній порт 80 на ваш ПК.

1. Відкрити веб-інтерфейс роутера (часто `192.168.0.1` або `192.168.50.1`).
2. Знайти розділ: **Port Forwarding** / **Проброс портів** / **Віртуальні сервери** / **NAT**.
3. Додати правило:

| Поле | Значення |
|------|----------|
| Зовнішній порт | 80 |
| Внутрішня IP | IP вашого ПК (наприклад `192.168.50.162`) |
| Внутрішній порт | 80 |
| Протокол | TCP |

4. Зберегти і перезавантажити роутер (якщо треба).

---

## 3. Firewall Windows

Дозволити вхід на порт 80:

**Через PowerShell (адміністратор):**
```powershell
New-NetFirewallRule -DisplayName "BUD Office HTTP" -Direction Inbound -LocalPort 80 -Protocol TCP -Action Allow
```

**Через інтерфейс:**
1. **Захист Windows** → **Брандмауэр і захист мережі** → **Додаткові параметри**.
2. **Правила для вхідних з’єднань** → **Створити правило**.
3. Тип: **Порт** → TCP, порт **80** → Дозволити з’єднання.

---

## 4. Backend — CORS для зовнішніх запитів

Backend має дозволяти запити з вашого публічного IP/домену.

У `Backend\.env`:
```env
CORS_ORIGINS=*
```

Або точніше (якщо знаєте адреси):
```env
CORS_ORIGINS=http://localhost,http://127.0.0.1,http://95.47.196.98
```

Після зміни перезапустіть Backend.

---

## 5. Frontend — відносні URL

У `Frontend\.env.production` має бути:
```
VITE_API_URL=/api
VITE_WS_URL=/
```

Це відносні шляхи — API і WebSocket використовуватимуть той самий хост, з якого відкрита сторінка (localhost або `95.47.196.98`). Нічого міняти не потрібно.

---

## 6. Nginx — слухати на всіх інтерфейсах

У `Deployment\nginx.conf` уже є `listen 80` — це всі мережеві інтерфейси. Нічого додатково не потрібно.

---

## 7. Запуск сервісів

### Варіант А: Вручну

1. **Backend:**
   ```cmd
   cd F:\BUD_office\Backend
   npm run start
   ```

2. **Nginx:**
   ```cmd
   F:\BUD_office\Deployment\run-nginx.bat
   ```

### Варіант Б: Через один .bat

```cmd
F:\BUD_office\Deployment\run-all-local.bat
```

---

## 8. Перевірка

### Локально
- http://localhost
- http://127.0.0.1
- http://192.168.50.162 (локальна мережа)

### З інтернету
1. Дізнатися публічну IP: https://2ip.ua або `whatismyip.com`.
2. Відкрити в браузері: `http://ВАША_ПУБЛІЧНА_IP`
3. Зв’язатися через мобільний інтернет (Wi‑Fi вимкнено на телефоні) — якщо відкривається, доступ ззовні працює.

---

## 9. Якщо IP змінюється (Dynamic DNS)

Якщо провайдер видає нову IP при кожному підключенні:

1. Зареєструватися на No-IP, DuckDNS або Dynu.
2. Отримати безкоштовний домен (наприклад `mybud.no-ip.org`).
3. Встановити клієнт DDNS на ПК або налаштувати оновлення в роутері.
4. Звертатися до `http://mybud.no-ip.org` замість IP.

---

## 10. Безпека (рекомендації)

1. **Сильний пароль** для облікового запису Windows.
2. **Оновлення** ОС і програм.
3. **HTTPS** (опціонально): домен + Let's Encrypt + налаштування SSL у Nginx.
4. **Обмеження доступу** (опціонально): файрвол на роутері лише для певних IP.
5. **Резервні копії** БД та важливих файлів.

---

## Усунення неполадок

| Проблема | Що перевірити |
|----------|---------------|
| Не відкривається з інтернету | Port forwarding 80 → ПК, firewall, публічна IP |
| Відкривається тільки локально | Роутер, можливо порт 80 зайнятий провайдером |
| API/WebSocket не працюють | CORS_ORIGINS у Backend, Nginx проксує `/api` і `/socket.io` |
| Зникає текст при редагуванні | Перевірити WebSocket (101 Upgrade) у Network, перезапустити Nginx |

---

## Швидкий чеклист

- [ ] ПК має фіксовану IP у локальній мережі
- [ ] Роутер: порт 80 → IP ПК
- [ ] Windows Firewall: дозволено вхід на порт 80
- [ ] Backend: `CORS_ORIGINS=*` у `.env`
- [ ] Backend і Nginx запущені
- [ ] `http://localhost` працює
- [ ] `http://ПУБЛІЧНА_IP` працює з інтернету
