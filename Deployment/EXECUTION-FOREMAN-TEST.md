# Інструкція тестування: Відділ реалізації + Кабінет виконроба

## 1. Міграція БД

Виконати один раз на сервері БД:

```bash
psql -U <user> -d <database> -f Backend/sql/2026-02-03_execution_tasks.sql
```

Або через клієнт виконати вміст файлу `Backend/sql/2026-02-03_execution_tasks.sql`.

---

## 2. Ролі та користувачі

- **Керівник реалізації** — потрібні права `execution:read` та `execution:write`. У тесті достатньо ролі `delivery_head` або `delivery_manager` (вони вже мають ці права після змін).
- **Виконроб** — роль `foreman`. Має `foreman:read`, `foreman:write`, `execution:read`.
- **Призначення виконроба на об'єкт:** у картці об'єкта (наприклад «Об'єкти» у відділі продажів/кошторису) має бути поле «Виконроб» (foremanId). Якщо такого поля немає в UI — тимчасово можна оновити в БД: `UPDATE projects SET "foremanId" = <user_id> WHERE id = <project_id>;`

---

## 3. Сценарій тесту (MVP)

1. **Увійти як керівник (delivery_head/delivery_manager).**
   - У меню з’являється «Відділ реалізації» → «Об'єкти».
   - Відкрити `/execution/projects` — список об'єктів (лише ті, де ви власник, тобто project.userId = ваш id).
   - Відкрити об'єкт → сторінка деталей з вкладками «Задачі» та «Події».

2. **Створити задачу.**
   - На сторінці об'єкта натиснути «Створити задачу».
   - Заповнити назву, вибрати виконроба (з списку кандидатів), за бажанням дедлайн, пріоритет, етап.
   - Зберегти. Задача з’являється в списку задач без перезавантаження (або після оновлення).

3. **Увійти як виконроб (foreman).**
   - У меню з’являється «Кабінет виконроба» → «Мої об'єкти».
   - Відкрити `/foreman` — у списку мають бути об'єкти, де foremanId = ваш id, або де ви assignee хоча б однієї активної задачі.
   - На картках об'єктів — бейджі «Задач: N», «Прострочено: N» (якщо є).

4. **Відкрити об'єкт у кабінеті виконроба.**
   - Відкрити об'єкт з задачею.
   - У блоці «Мої задачі» має бути задача, створена керівником.
   - Натиснути «В роботу» → статус змінюється на in_progress.
   - Натиснути «Готово» → статус done. Або «Очікування» (blocked), за потреби ввести причину.

5. **Повернутися під керівником.**
   - Відкрити той самий об'єкт у «Відділ реалізації» → «Задачі».
   - Переконатися, що статус задачі оновився (наприклад, «Готово»).
   - Вкладка «Події» — у стрічці мають бути події типу «Зміна статусу задачі», «Задачу створено» тощо.

6. **Доступи.**
   - Користувач без `execution:read` не бачить пункт «Відділ реалізації» і не має відкривати `/execution/projects`.
   - Користувач без `foreman:read` не бачить «Кабінет виконроба» і не має відкривати `/foreman`.

7. **Прострочені.**
   - Створити задачу з дедлайном у минулому, статус не «Готово».
   - У списку об'єктів (реалізація) має з’явитися бейдж «Прострочено: 1» (або відповідна кількість).

---

## 4. Перевірка, що нічого не зламано

- КП, Акти, Накладні, Склади, Sheet — без змін; переконатися, що основні операції працюють як раніше.
- Існуючі роути та меню (delivery, estimate, supply, sales, foreman) — без зайвих змін, окрім доданих пунктів та бейджів.
