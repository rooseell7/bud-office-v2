# Інструкція тестування: Відділ фінансів

## 1. Міграція БД

Виконати один раз:

```bash
psql -U <user> -d <database> -f Backend/sql/2026-02-03_finance.sql
```

Або виконати вміст файлу `Backend/sql/2026-02-03_finance.sql` у клієнті БД.

---

## 2. Ролі та права

- **Фінансист/бухгалтер:** роль `accountant` — має `finance:read`, `finance:write` (перегляд і створення/редагування транзакцій та гаманців).
- **Адмін:** має також `finance:admin` (у поточній реалізації створення гаманців дозволено вже при `finance:write`).

Переконайтесь, що тестовий користувач має роль `accountant` або `admin`.

---

## 3. Сценарій тесту (MVP)

### 3.1 Доступ і меню

1. Увійти під користувачем з `finance:read`.
2. У меню має з’явитися «Відділ фінансів» → «Фінанси».
3. Відкрити `/finance` — дашборд фінансів.

### 3.2 Гаманці

1. Перейти у «Гаманці» (кнопка на дашборді) або `/finance/wallets`.
2. Натиснути «Додати ФОП / гаманець».
3. Заповнити: назва «Каса», тип «Каса», валюта UAH → Зберегти.
4. Додати ще один: «ФОП Тест», тип «ФОП», валюта UAH.
5. Обидва гаманці мають з’явитися в списку та на дашборді в блоці «Баланси» (спочатку 0).

### 3.3 Прихід (IN)

1. На дашборді натиснути «Отримали гроші».
2. Обрати гаманець «Каса», сума 10000, валюта UAH, категорія «Оплата від замовника», контрагент «Замовник» → Зберегти.
3. У блоці «Баланси» баланс «Каса» має стати 10000 UAH.
4. У журналі операцій з’явиться рядок «Прихід» на 10000 UAH.

### 3.4 Витрата (OUT)

1. Натиснути «Оплатили».
2. Гаманець «Каса», сума 2000, категорія «Матеріали», контрагент «Постачальник» → Зберегти.
3. Баланс «Каса» має стати 8000 UAH.
4. У журналі — рядок «Витрата» 2000 UAH.

### 3.5 Переказ (TRANSFER)

1. Натиснути «Переказ між гаманцями».
2. З гаманця «Каса», в гаманець «ФОП Тест», сума 3000 UAH → Зберегти.
3. Баланс «Каса» — 5000 UAH, «ФОП Тест» — 3000 UAH.
4. У журналі — операція «Переказ».

### 3.6 Валюта та курс (FX)

1. «Отримали гроші» → гаманець з валютою USD (якщо є) або створити гаманець USD.
2. Сума 100 USD, курс до UAH 41 → має з’явитися еквівалент ≈ 4100 UAH.
3. У журналі та балансах має відображатися amountUAH (еквівалент).

### 3.7 Фільтри журналу

1. Вказати період (з/по дати), гаманець, тип (Прихід/Витрата/Переказ).
2. Список операцій має оновитися відповідно до фільтрів.

### 3.8 Фінанси об’єкта (Phase 2)

1. Відкрити сторінку будь-якого об’єкта (наприклад `/projects/1` або `/sales/objects/1`).
2. При наявності `finance:read` має з’явитися вкладка «Фінанси».
3. Відкрити вкладку «Фінанси» — показ прихід/витрата/баланс по об’єкту (спочатку можуть бути 0).
4. Натиснути «+ Отримали гроші (для цього обʼєкта)» — заповнити форму (об’єкт вже підставлений), зберегти.
5. У вкладці «Фінанси» мають оновитися сума приходу та список операцій; баланс об’єкта = прихід − витрата.
6. Аналогічно перевірити «– Оплатили (для цього обʼєкта)».

---

## 4. Регресія

- Сторінки КП, Акти, Накладні, Склади, Sheet, Execution, Foreman — без змін; переконатися, що основні дії працюють як раніше.
- Без змін у роутері/стейті/меню інших модулів, окрім доданого пункту «Фінанси» та вкладки «Фінанси» на сторінці об’єкта.
