import{u as L,a as M,b as V,r as f,g as D,j as t,B as o,c as I,A as W,T as s,P as G,f as g,d as E}from"./index-D9d13f7b.js";import{w as J}from"./worksSheetConfig-BsCs0GIO.js";function d(e){if(e==null)return 0;const a=Number(e);return Number.isFinite(a)?a:0}function O(e){const a=[];let l=null;for(const n of e){const i=n?.rowType??n?.type;i==="section"?(l={sectionKey:n?.sectionKey??"sec_1",title:String(n?.title??"Роботи"),works:[]},a.push(l)):i==="work"&&l&&l.works.push(n)}if(a.length===0){const n=(e??[]).filter(i=>(i?.rowType??i?.type)==="work");a.push({sectionKey:"sec_1",title:"Роботи",works:n})}return a}function Q(e,a){const l=d(e?.qty),n=d(e?.price),i=d(e?.costPrice??e?.cost),u=l*n,C=l*i,m=j=>j.toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g," ");return[String(a+1),String(e?.name??e?.title??""),String(e?.unit??""),String(l),m(n),m(u),m(i),m(C),String(e?.note??"")]}const Z=()=>{const{id:e}=L(),a=M(),l=V(),n=e?parseInt(e,10):NaN,i=Number.isFinite(n)&&n>0?n:null,[u,C]=f.useState(null),[m,j]=f.useState(!0),[z,P]=f.useState(null),A=f.useCallback(()=>{const r=l.state?.from||"/estimate/acts";window.location.href=r},[l.state]),K=f.useCallback(()=>{window.print()},[]);if(f.useEffect(()=>{if(!i){j(!1);return}j(!0),P(null),D(i).then(C).catch(r=>{P(r?.message||"Помилка завантаження")}).finally(()=>j(!1))},[i]),!i)return t.jsxs(o,{className:"act-read noprint",children:[t.jsx(I,{startIcon:t.jsx(W,{}),onClick:()=>a("/estimate/acts"),children:"Назад"}),t.jsx(s,{color:"error",sx:{mt:2},children:"Невірний ідентифікатор"})]});if(m&&!u)return t.jsx(o,{className:"act-read noprint",children:t.jsx(s,{children:"Завантаження…"})});if(z&&!u)return t.jsxs(o,{className:"act-read noprint",children:[t.jsx(I,{startIcon:t.jsx(W,{}),onClick:A,children:"Назад"}),t.jsx(s,{color:"error",sx:{mt:2},children:z})]});const S=O(u?.items??[]),B=S.reduce((r,b)=>{for(const h of b.works){const p=d(h?.qty),v=d(h?.price),w=d(h?.costPrice??h?.cost);r.sum+=p*v,r.cost+=p*w}return r},{sum:0,cost:0}),k=B.sum,q=B.cost,T=k-q,F=k>0?T/k*100:0,U=J,N=[0,1,2,3,4,5,6,7,8],R=U.filter((r,b)=>N.includes(b));return t.jsxs(o,{className:"act-read",sx:{width:"100%",maxWidth:"100%"},children:[t.jsxs(o,{className:"noprint",sx:{display:"flex",alignItems:"center",gap:1,mb:2,flexWrap:"wrap"},children:[t.jsx(I,{size:"small",startIcon:t.jsx(W,{}),onClick:A,children:"Назад"}),t.jsxs(s,{variant:"h6",sx:{flex:1},children:["Акт №",u?.id," — режим читання"]}),t.jsx(I,{size:"small",startIcon:t.jsx(G,{}),variant:"contained",onClick:K,children:"Друк"})]}),S.length>0&&t.jsxs(o,{className:"act-read-totals",sx:{display:"flex",flexWrap:"wrap",gap:2,p:1,mb:2,borderRadius:1,bgcolor:"action.hover",border:"1px solid",borderColor:"divider"},children:[t.jsx(s,{sx:{fontSize:12,fontWeight:600,color:"text.secondary",mr:1},children:"Загалом по акту"}),t.jsxs(o,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[t.jsx(s,{sx:{fontSize:11,color:"text.secondary"},children:"Роботи:"}),t.jsx(s,{sx:{fontSize:13,fontWeight:600},children:g(k)})]}),t.jsxs(o,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[t.jsx(s,{sx:{fontSize:11,color:"text.secondary"},children:"Собівартість:"}),t.jsx(s,{sx:{fontSize:13,fontWeight:600},children:g(q)})]}),t.jsxs(o,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[t.jsx(s,{sx:{fontSize:11,color:"text.secondary"},children:"Маржа:"}),t.jsx(s,{sx:{fontSize:13,fontWeight:600},children:E(F)})]}),t.jsxs(o,{sx:{display:"flex",gap:.5,alignItems:"baseline"},children:[t.jsx(s,{sx:{fontSize:11,color:"text.secondary"},children:"Прибуток:"}),t.jsx(s,{sx:{fontSize:13,fontWeight:600},children:g(T)})]})]}),S.length===0?t.jsx(s,{color:"text.secondary",children:"Немає секцій"}):S.map((r,b)=>{const h=r.works.map((x,c)=>Q(x,c)),p=r.works.reduce((x,c)=>x+d(c?.qty)*d(c?.price),0),v=r.works.reduce((x,c)=>x+d(c?.qty)*d(c?.costPrice??c?.cost),0),w=p-v,_=p>0?w/p*100:0;return t.jsxs(o,{className:"act-read-stage",sx:{breakInside:"avoid",pageBreakInside:"avoid",mb:3,pb:2,borderBottom:"1px solid",borderColor:"divider"},children:[t.jsxs(s,{variant:"h6",sx:{mb:1.5,pb:.5,borderBottom:"1px solid",borderColor:"divider",fontWeight:600},children:["Секція ",b+1,": ",r.title]}),t.jsxs(o,{sx:{mb:2},children:[t.jsx(s,{variant:"subtitle2",sx:{mb:.5,fontWeight:600},children:"Роботи"}),t.jsxs(o,{component:"table",sx:{width:"100%",borderCollapse:"collapse",fontSize:13,"& th, & td":{border:"1px solid",borderColor:"divider",px:1,py:.5},"& th":{bgcolor:"action.hover",fontWeight:600,textAlign:"left"},"& td":{verticalAlign:"top"},"& .num":{textAlign:"right",fontVariantNumeric:"tabular-nums"}},children:[t.jsx("thead",{children:t.jsx("tr",{children:R.map((x,c)=>{const y=N[c];return t.jsx("th",{className:y!=null&&[4,5,6,7].includes(y)?"num":"",children:x},c)})})}),t.jsx("tbody",{children:h.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:R.length,children:"—"})}):h.map((x,c)=>t.jsx("tr",{children:N.map((y,H)=>t.jsx("td",{className:[4,5,6,7].includes(y)?"num":"",children:x[y]??"—"},H))},c))})]}),t.jsx(o,{sx:{display:"flex",justifyContent:"flex-end",mt:.5,py:.75,px:1,bgcolor:"action.hover",borderRadius:.5,fontSize:12},children:t.jsxs("span",{children:["Разом: ",g(p)," · Собівартість: ",g(v)," · Прибуток:"," ",g(w)," · Маржа ",E(_)]})})]})]},r.sectionKey)}),t.jsx("style",{children:`
        @media print {
          body * { visibility: hidden; }
          .act-read, .act-read * { visibility: visible; }
          .act-read { position: absolute; left: 0; top: 0; width: 100%; padding: 0; }
          .noprint { display: none !important; }
          .act-read-stage { break-inside: avoid; page-break-inside: avoid; }
          .boHeader, .boSidebar, [class*="AppBar"], [class*="Drawer"] { display: none !important; }
        }
      `})]})};export{Z as ActReadPage};
//# sourceMappingURL=ActReadPage-DH3JKIbN.js.map
