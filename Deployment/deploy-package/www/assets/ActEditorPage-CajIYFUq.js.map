{"version":3,"file":"ActEditorPage-CajIYFUq.js","sources":["../../src/sheet/hooks/useActSheetAdapter.ts","../../src/pages/acts/ActEditorPage.tsx"],"sourcesContent":["/**\r\n * Act section sheet adapter. Converts Act items (sections + works) to SheetSnapshot.\r\n * REST via updateAct — no collab.\r\n * Used by Act editor: Works only, one sheet per section (stage).\r\n */\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { getAct, updateAct } from '../../api/acts';\r\nimport type { SheetSnapshot } from '../engine/types';\r\nimport { W_COL } from '../configs/worksSheetConfig';\r\n\r\ntype ActItem = { rowType?: string; type?: string; sectionKey?: string; [k: string]: any };\r\n\r\nfunction n(v: unknown): number {\r\n  if (v === null || v === undefined) return 0;\r\n  const x = Number(v);\r\n  return Number.isFinite(x) ? x : 0;\r\n}\r\n\r\n/** Extract works for a section from act items */\r\nfunction getWorksForSection(items: ActItem[], sectionKey: string): ActItem[] {\r\n  const out: ActItem[] = [];\r\n  for (const r of items) {\r\n    const t = r?.rowType ?? r?.type;\r\n    if (t === 'work' && (r?.sectionKey === sectionKey || !sectionKey)) {\r\n      out.push(r);\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\nconst DEFAULT_ACT_ROWS = 20;\r\n\r\n/** Build SheetSnapshot from work rows (worksSheetConfig columns) */\r\nfunction worksToSnapshot(works: ActItem[]): SheetSnapshot {\r\n  const rowCount = Math.max(works.length, DEFAULT_ACT_ROWS);\r\n  const colCount = 9; // worksSheetConfig\r\n  const rawValues: string[][] = [];\r\n  for (let r = 0; r < rowCount; r++) {\r\n    const w = works[r];\r\n    rawValues[r] = [\r\n      '', // NUM - computed\r\n      String(w?.name ?? w?.title ?? ''),\r\n      String(w?.unit ?? ''),\r\n      String(n(w?.qty)),\r\n      String(n(w?.price)),\r\n      '', // TOTAL - computed\r\n      String(n(w?.costPrice ?? w?.cost)),\r\n      '', // COST_TOTAL - computed\r\n      String(w?.note ?? ''),\r\n    ];\r\n  }\r\n  return {\r\n    rawValues,\r\n    values: rawValues.map((row) => [...row]),\r\n    rowCount,\r\n    colCount,\r\n  };\r\n}\r\n\r\n/** Convert SheetSnapshot rows to Act work items */\r\nfunction snapshotToWorks(snapshot: SheetSnapshot, sectionKey: string): ActItem[] {\r\n  const raw = snapshot.rawValues ?? snapshot.values ?? [];\r\n  const out: ActItem[] = [];\r\n  for (const row of raw) {\r\n    if (!row) continue;\r\n    const name = String(row[W_COL.NAME] ?? '').trim();\r\n    const unit = String(row[W_COL.UNIT] ?? '').trim();\r\n    const qty = n(row[W_COL.QTY]);\r\n    const price = n(row[W_COL.PRICE]);\r\n    const costUnit = n(row[W_COL.COST_UNIT]);\r\n    const note = String(row[W_COL.NOTE] ?? '').trim();\r\n    if (!name && !unit && qty === 0 && price === 0) continue; // skip empty\r\n    out.push({\r\n      rowType: 'work',\r\n      type: 'work',\r\n      sectionKey,\r\n      name: name || '',\r\n      unit: unit || '',\r\n      qty,\r\n      price,\r\n      costPrice: costUnit,\r\n      note: note || undefined,\r\n    });\r\n  }\r\n  if (out.length === 0) {\r\n    out.push({\r\n      rowType: 'work',\r\n      type: 'work',\r\n      sectionKey,\r\n      name: '',\r\n      unit: '',\r\n      qty: 0,\r\n      price: 0,\r\n      costPrice: 0,\r\n    });\r\n  }\r\n  return out;\r\n}\r\n\r\n/** Merge section works into full items, preserve meta/section/percent/subtotal */\r\nfunction mergeSectionWorks(items: ActItem[], sectionKey: string, newWorks: ActItem[]): ActItem[] {\r\n  const result: ActItem[] = [];\r\n  let replacing = false;\r\n  for (const r of items) {\r\n    const t = r?.rowType ?? r?.type;\r\n    const sk = r?.sectionKey;\r\n    if (t === 'meta') {\r\n      result.push(r);\r\n      replacing = false;\r\n      continue;\r\n    }\r\n    if (t === 'section') {\r\n      replacing = sk === sectionKey;\r\n      result.push(r);\r\n      if (replacing) result.push(...newWorks);\r\n      continue;\r\n    }\r\n    if (replacing && sk === sectionKey && t === 'work') continue;\r\n    result.push(r);\r\n  }\r\n  const hasSection = items.some((r) => (r?.rowType ?? r?.type) === 'section' && r?.sectionKey === sectionKey);\r\n  if (!hasSection) {\r\n    result.push({ rowType: 'section', type: 'section', sectionKey, title: 'Роботи' }, ...newWorks);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport type ActAdapterMode = 'loading' | 'edit' | 'readonly';\r\n\r\nexport function useActSheetAdapter(\r\n  actId: number | null,\r\n  sectionKey: string | null,\r\n  items: ActItem[],\r\n  onSaved?: () => void,\r\n) {\r\n  const [mode, setMode] = useState<ActAdapterMode>('loading');\r\n  const [initialSnapshot, setInitialSnapshot] = useState<SheetSnapshot | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!actId || !sectionKey) {\r\n      setMode('edit');\r\n      setInitialSnapshot(null);\r\n      return;\r\n    }\r\n    const works = getWorksForSection(items, sectionKey);\r\n    setInitialSnapshot(worksToSnapshot(works));\r\n    setMode('edit');\r\n  }, [actId, sectionKey, JSON.stringify(items.map((i) => ({ sk: i?.sectionKey, t: i?.rowType ?? i?.type })))]);\r\n\r\n  const adapter = {\r\n    getDraftKey: () => (actId && sectionKey ? `act:${actId}:${sectionKey}` : null),\r\n\r\n    loadSnapshot: async () => {\r\n      if (!actId) return null;\r\n      const act = await getAct(actId);\r\n      const works = getWorksForSection(act.items ?? [], sectionKey!);\r\n      return { snapshot: worksToSnapshot(works), revision: 0 };\r\n    },\r\n\r\n    saveSnapshot: async (snapshot: SheetSnapshot): Promise<{ revision?: number }> => {\r\n      if (!actId || !sectionKey) throw new Error('No act or sectionKey');\r\n      const act = await getAct(actId);\r\n      const currentItems = act.items ?? [];\r\n      const newWorks = snapshotToWorks(snapshot, sectionKey);\r\n      const merged = mergeSectionWorks(currentItems, sectionKey, newWorks);\r\n      const compat = merged.map((r) => {\r\n        const anyR: any = { ...r };\r\n        if (typeof anyR.rowType === 'string') anyR.type = anyR.rowType;\r\n        if (anyR.rowType === 'work') {\r\n          anyR.title = anyR.name;\r\n          anyR.cost = anyR.costPrice;\r\n        }\r\n        if (anyR.rowType === 'percent') {\r\n          anyR.title = anyR.name;\r\n          anyR.percent = anyR.percentValue;\r\n        }\r\n        return anyR;\r\n      });\r\n      await updateAct(actId, {\r\n        projectId: act.projectId,\r\n        foremanId: act.foremanId,\r\n        actDate: act.actDate,\r\n        status: act.status,\r\n        items: compat,\r\n      });\r\n      onSaved?.();\r\n      return { revision: 0 };\r\n    },\r\n  };\r\n\r\n  return { adapter, mode, initialSnapshot };\r\n}\r\n","/**\r\n * Act editor — Sheet engine 1:1 with KP, Works only.\r\n * Sections = stages, each section has one Sheet (works).\r\n */\r\n\r\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate, useParams, useLocation } from 'react-router-dom';\r\nimport {\r\n  Accordion,\r\n  AccordionDetails,\r\n  AccordionSummary,\r\n  Box,\r\n  Button,\r\n  Chip,\r\n  FormControlLabel,\r\n  Switch,\r\n  Tooltip,\r\n  Typography,\r\n} from '@mui/material';\r\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack';\r\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\r\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\r\nimport { Sheet, formatUaMoney, formatPercent, type SheetTotals } from '../../sheet';\r\nimport { worksSheetConfig } from '../../sheet/configs/worksSheetConfig';\r\nimport { W_COL } from '../../sheet/configs/worksSheetConfig';\r\nimport { useActSheetAdapter } from '../../sheet/hooks/useActSheetAdapter';\r\nimport { useAuth } from '../../modules/auth/context/AuthContext';\r\nimport { getAct, updateAct, type ActDto } from '../../api/acts';\r\nimport { lsGetJson, lsSetJson } from '../../shared/localStorageJson';\r\n\r\nconst ACT_LOCK_COLUMNS = true;\r\nconst ACT_ALLOW_COLUMN_INSERT = true;\r\nconst LS_HIDE_COST = (actId: number) => `act:${actId}:hideCost`;\r\nconst LS_EXPANDED_SECTIONS = (actId: number) => `act:${actId}:expandedSections`;\r\n\r\nfunction ensureBaseStructure(items: any[] | undefined): any[] {\r\n  const src = Array.isArray(items) ? items : [];\r\n  const out = [...src];\r\n  const hasMeta = out.some((r: any) => r?.rowType === 'meta' || r?.type === 'meta');\r\n  if (!hasMeta) out.unshift({ rowType: 'meta', type: 'meta', header: {} });\r\n  const hasSection = out.some((r: any) => r?.rowType === 'section' || r?.type === 'section');\r\n  const hasWork = out.some((r: any) => r?.rowType === 'work' || r?.type === 'work');\r\n  if (!hasSection) out.push({ rowType: 'section', type: 'section', sectionKey: 'sec_1', title: 'Роботи' });\r\n  if (!hasWork) out.push({ rowType: 'work', type: 'work', sectionKey: 'sec_1', name: '', unit: '', qty: 0, price: 0, costPrice: 0 });\r\n  return out;\r\n}\r\n\r\nfunction extractSections(items: any[]): { sectionKey: string; title: string }[] {\r\n  const seen = new Set<string>();\r\n  const out: { sectionKey: string; title: string }[] = [];\r\n  for (const r of items) {\r\n    const t = r?.rowType ?? r?.type;\r\n    if (t === 'section' && r?.sectionKey && !seen.has(r.sectionKey)) {\r\n      seen.add(r.sectionKey);\r\n      out.push({\r\n        sectionKey: r.sectionKey,\r\n        title: String(r?.title ?? 'Роботи'),\r\n      });\r\n    }\r\n  }\r\n  if (out.length === 0) out.push({ sectionKey: 'sec_1', title: 'Роботи' });\r\n  return out;\r\n}\r\n\r\nexport const ActEditorPage: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const loc = useLocation();\r\n  const goBack = useCallback(() => {\r\n    const target = (loc.state as { from?: string })?.from || '/estimate/acts';\r\n    window.location.href = target;\r\n  }, [loc.state]);\r\n\r\n  const { can } = useAuth();\r\n  const actId = id ? parseInt(id, 10) : NaN;\r\n  const validId = Number.isFinite(actId) && actId > 0 ? actId : null;\r\n\r\n  const [act, setAct] = useState<ActDto | null>(null);\r\n  const [items, setItems] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [hideCost, setHideCostState] = useState(false);\r\n  const [expandedSections, setExpandedSections] = useState<Set<string>>(() => new Set());\r\n  const [viewMode, setViewMode] = useState(false);\r\n  const [totalsBySection, setTotalsBySection] = useState<Record<string, SheetTotals>>({});\r\n\r\n  const canWrite = can('delivery:write') || can('estimates:write');\r\n\r\n  useEffect(() => {\r\n    if (!validId) return;\r\n    setHideCostState(lsGetJson(LS_HIDE_COST(validId), false));\r\n  }, [validId]);\r\n\r\n  const setHideCost = useCallback(\r\n    (v: boolean) => {\r\n      setHideCostState(v);\r\n      if (validId) lsSetJson(LS_HIDE_COST(validId), v);\r\n    },\r\n    [validId],\r\n  );\r\n\r\n  const loadAct = useCallback(async () => {\r\n    if (!validId) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const data = await getAct(validId);\r\n      setAct(data);\r\n      const normalized = ensureBaseStructure(data.items);\r\n      setItems(normalized);\r\n      const sections = extractSections(normalized);\r\n      setExpandedSections((prev) => {\r\n        const saved = lsGetJson<string[]>(LS_EXPANDED_SECTIONS(validId), []);\r\n        const valid = saved.filter((s) => sections.some((sec) => sec.sectionKey === s));\r\n        if (valid.length > 0) return new Set(valid);\r\n        if (prev.size > 0) {\r\n          const filtered = [...prev].filter((s) => sections.some((sec) => sec.sectionKey === s));\r\n          return filtered.length > 0 ? new Set(filtered) : new Set(sections.map((s) => s.sectionKey));\r\n        }\r\n        return new Set(sections.slice(0, 1).map((s) => s.sectionKey));\r\n      });\r\n    } catch (e: any) {\r\n      setError(e?.message || 'Помилка завантаження');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [validId]);\r\n\r\n  useEffect(() => {\r\n    if (!validId) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    loadAct();\r\n  }, [validId, loadAct]);\r\n\r\n  const handleSectionExpand = useCallback(\r\n    (sectionKey: string) => {\r\n      setExpandedSections((prev) => {\r\n        const next = new Set(prev);\r\n        next.add(sectionKey);\r\n        if (validId) lsSetJson(LS_EXPANDED_SECTIONS(validId), [...next]);\r\n        return next;\r\n      });\r\n    },\r\n    [validId],\r\n  );\r\n\r\n  const handleSectionCollapse = useCallback(\r\n    (sectionKey: string) => {\r\n      setExpandedSections((prev) => {\r\n        const next = new Set(prev);\r\n        next.delete(sectionKey);\r\n        if (validId) lsSetJson(LS_EXPANDED_SECTIONS(validId), [...next]);\r\n        return next;\r\n      });\r\n    },\r\n    [validId],\r\n  );\r\n\r\n  const sections = useMemo(() => extractSections(items), [items]);\r\n\r\n  const agg = useMemo(() => {\r\n    let worksSum = 0;\r\n    let worksCost = 0;\r\n    for (const t of Object.values(totalsBySection)) {\r\n      worksSum += t.sum;\r\n      worksCost += t.cost;\r\n    }\r\n    return { worksSum, worksCost };\r\n  }, [totalsBySection]);\r\n\r\n  if (!validId) {\r\n    return (\r\n      <Box>\r\n        <Button startIcon={<ArrowBackIcon />} onClick={() => navigate('/estimate/acts')}>\r\n          Назад\r\n        </Button>\r\n        <Typography color=\"error\" sx={{ mt: 2 }}>\r\n          Невірний ідентифікатор\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (loading && !act) {\r\n    return (\r\n      <Box>\r\n        <Typography>Завантаження…</Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (error && !act) {\r\n    return (\r\n      <Box>\r\n        <Button startIcon={<ArrowBackIcon />} onClick={goBack}>\r\n          Назад\r\n        </Button>\r\n        <Typography color=\"error\" sx={{ mt: 2 }}>\r\n          {error}\r\n        </Typography>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  if (!act) {\r\n    return null;\r\n  }\r\n\r\n  const totalSum = agg.worksSum;\r\n  const totalCost = agg.worksCost;\r\n  const totalProfit = totalSum - totalCost;\r\n  const marginPct = totalSum > 0 ? (totalProfit / totalSum) * 100 : 0;\r\n\r\n  return (\r\n    <Box className=\"act-editor-full\" sx={{ width: '100%', maxWidth: '100%' }}>\r\n      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1.5, flexWrap: 'wrap' }}>\r\n        <Button size=\"small\" startIcon={<ArrowBackIcon />} onClick={goBack}>\r\n          Назад\r\n        </Button>\r\n        <Typography variant=\"h6\" sx={{ flex: 1 }}>\r\n          Акт №{act.id}\r\n        </Typography>\r\n        <Chip size=\"small\" label={`Дата: ${act.actDate}`} />\r\n        <Chip size=\"small\" label={act.status} />\r\n        {canWrite && (\r\n          <Tooltip title=\"Режим тільки перегляд\">\r\n            <FormControlLabel\r\n              control={<Switch size=\"small\" checked={viewMode} onChange={(_, v) => setViewMode(v)} color=\"primary\" />}\r\n              label={<Typography sx={{ fontSize: 12 }}>Тільки перегляд</Typography>}\r\n            />\r\n          </Tooltip>\r\n        )}\r\n        <Tooltip title=\"Приховати колонки собівартості\">\r\n          <FormControlLabel\r\n            control={<Switch size=\"small\" checked={hideCost} onChange={(_, v) => setHideCost(v)} color=\"primary\" />}\r\n            label={<Typography sx={{ fontSize: 12 }}>Приховати собівартість</Typography>}\r\n          />\r\n        </Tooltip>\r\n      </Box>\r\n\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          flexWrap: 'wrap',\r\n          gap: 2,\r\n          p: 0.75,\r\n          mb: 1,\r\n          borderRadius: 1,\r\n          bgcolor: 'action.hover',\r\n          border: '1px solid',\r\n          borderColor: 'divider',\r\n          alignItems: 'center',\r\n        }}\r\n      >\r\n        <Typography sx={{ fontSize: 11, fontWeight: 600, color: 'text.secondary', mr: 0.5 }}>\r\n          Загалом по акту\r\n        </Typography>\r\n        <Box sx={{ display: 'flex', alignItems: 'baseline', gap: 0.5 }}>\r\n          <Typography sx={{ fontSize: 11, color: 'text.secondary' }}>Роботи:</Typography>\r\n          <Typography sx={{ fontSize: 13, fontWeight: 600 }}>{formatUaMoney(agg.worksSum)}</Typography>\r\n        </Box>\r\n        {!hideCost && (\r\n          <>\r\n            <Box sx={{ display: 'flex', alignItems: 'baseline', gap: 0.5 }}>\r\n              <Typography sx={{ fontSize: 11, color: 'text.secondary' }}>Собівартість:</Typography>\r\n              <Typography sx={{ fontSize: 13, fontWeight: 600 }}>{formatUaMoney(totalCost)}</Typography>\r\n            </Box>\r\n            <Box sx={{ display: 'flex', alignItems: 'baseline', gap: 0.5 }}>\r\n              <Typography sx={{ fontSize: 11, color: 'text.secondary' }}>Маржа:</Typography>\r\n              <Typography sx={{ fontSize: 13, fontWeight: 600 }}>{formatPercent(marginPct)}</Typography>\r\n            </Box>\r\n            <Box sx={{ display: 'flex', alignItems: 'baseline', gap: 0.5 }}>\r\n              <Typography sx={{ fontSize: 11, color: 'text.secondary' }}>Прибуток:</Typography>\r\n              <Typography sx={{ fontSize: 13, fontWeight: 600 }}>{formatUaMoney(totalProfit)}</Typography>\r\n            </Box>\r\n          </>\r\n        )}\r\n      </Box>\r\n\r\n      <Typography variant=\"subtitle2\" color=\"text.secondary\" sx={{ mb: 1 }}>\r\n        Секції (роботи)\r\n      </Typography>\r\n\r\n      {sections.length === 0 ? (\r\n        <Typography color=\"text.secondary\">Немає секцій</Typography>\r\n      ) : (\r\n        sections.map((sec) => (\r\n          <ActSectionAccordion\r\n            key={sec.sectionKey}\r\n            section={sec}\r\n            actId={validId}\r\n            items={items}\r\n            onItemsRefresh={() => loadAct()}\r\n            expanded={expandedSections.has(sec.sectionKey)}\r\n            onExpand={() => handleSectionExpand(sec.sectionKey)}\r\n            onCollapse={() => handleSectionCollapse(sec.sectionKey)}\r\n            canEdit={!viewMode && canWrite}\r\n            hideCost={hideCost}\r\n            onTotalsChange={(t) => setTotalsBySection((prev) => ({ ...prev, [sec.sectionKey]: t }))}\r\n          />\r\n        ))\r\n      )}\r\n    </Box>\r\n  );\r\n};\r\n\r\ntype ActSectionAccordionProps = {\r\n  section: { sectionKey: string; title: string };\r\n  actId: number;\r\n  items: any[];\r\n  onItemsRefresh: () => void;\r\n  expanded: boolean;\r\n  onExpand: () => void;\r\n  onCollapse: () => void;\r\n  canEdit: boolean;\r\n  hideCost: boolean;\r\n  onTotalsChange: (t: SheetTotals) => void;\r\n};\r\n\r\nfunction ActSectionAccordion({\r\n  section,\r\n  actId,\r\n  items,\r\n  onItemsRefresh,\r\n  expanded,\r\n  onExpand,\r\n  onCollapse,\r\n  canEdit,\r\n  hideCost,\r\n  onTotalsChange,\r\n}: ActSectionAccordionProps) {\r\n  const config = ACT_LOCK_COLUMNS\r\n    ? {\r\n        ...worksSheetConfig,\r\n        allowColumnInsert: ACT_ALLOW_COLUMN_INSERT,\r\n        allowColumnDelete: false,\r\n        allowColumnRename: false,\r\n      }\r\n    : worksSheetConfig;\r\n  const configWithAutocomplete = {\r\n    ...config,\r\n    autocompleteForColumn: { colIndex: 1, type: 'works' as const },\r\n    hiddenColumns: hideCost ? [6, 7] : undefined,\r\n    allowCellComments: true,\r\n    allowFreeze: true,\r\n  };\r\n\r\n  const { adapter, initialSnapshot } = useActSheetAdapter(actId, section.sectionKey, items, onItemsRefresh ?? undefined);\r\n  const [sectionTotals, setSectionTotals] = React.useState<SheetTotals>({ sum: 0, cost: 0, profit: 0 });\r\n\r\n  React.useEffect(() => {\r\n    onTotalsChange(sectionTotals);\r\n  }, [sectionTotals, onTotalsChange]);\r\n\r\n  const handleTotalsChange = React.useCallback((t: SheetTotals) => {\r\n    setSectionTotals(t);\r\n  }, []);\r\n\r\n  return (\r\n    <Accordion\r\n      expanded={expanded}\r\n      onChange={(_, isExp) => (isExp ? onExpand() : onCollapse())}\r\n      sx={{\r\n        '&:before': { display: 'none' },\r\n        boxShadow: 0,\r\n        border: '1px solid',\r\n        borderColor: 'divider',\r\n        mb: 0.5,\r\n      }}\r\n    >\r\n      <AccordionSummary expandIcon={expanded ? <ExpandLessIcon /> : <ExpandMoreIcon />} sx={{ minHeight: 44, '& .MuiAccordionSummary-content': { my: 0.5 } }}>\r\n        <Typography variant=\"body2\" fontWeight={600}>\r\n          {section.title}\r\n        </Typography>\r\n      </AccordionSummary>\r\n      <AccordionDetails sx={{ pt: 0, px: 0 }}>\r\n        <Box sx={{ pt: 0.5, position: 'relative' }}>\r\n          <Sheet\r\n            config={configWithAutocomplete}\r\n            adapter={adapter ?? undefined}\r\n            documentId={null}\r\n            initialSnapshot={initialSnapshot}\r\n            readonly={!canEdit}\r\n            totalsConfig={{ sumCol: W_COL.TOTAL, costCol: W_COL.COST_TOTAL }}\r\n            onTotalsChange={handleTotalsChange}\r\n          />\r\n          <Box sx={{ display: 'flex', justifyContent: 'flex-end', mt: 0.5 }}>\r\n            <SectionTotalsBlock totals={sectionTotals} hideCost={hideCost} />\r\n          </Box>\r\n        </Box>\r\n      </AccordionDetails>\r\n    </Accordion>\r\n  );\r\n}\r\n\r\nfunction SectionTotalsBlock({ totals, hideCost }: { totals: SheetTotals; hideCost: boolean }) {\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'flex-end',\r\n        gap: 0.25,\r\n        px: 1.5,\r\n        py: 0.75,\r\n        fontSize: 12,\r\n        bgcolor: 'action.hover',\r\n        borderRadius: 1,\r\n        border: '1px solid',\r\n        borderColor: 'divider',\r\n      }}\r\n    >\r\n      {hideCost ? (\r\n        <span>\r\n          <span style={{ color: 'var(--mui-palette-text-secondary)' }}>Роботи:</span> <strong>{formatUaMoney(totals.sum)}</strong>\r\n        </span>\r\n      ) : (\r\n        <>\r\n          <span>\r\n            <span style={{ color: 'var(--mui-palette-text-secondary)' }}>Роботи:</span>{' '}\r\n            <strong>{formatUaMoney(totals.sum)} / соб. {formatUaMoney(totals.cost)}</strong>\r\n          </span>\r\n        </>\r\n      )}\r\n    </Box>\r\n  );\r\n}\r\n"],"names":["n","v","x","getWorksForSection","items","sectionKey","out","r","DEFAULT_ACT_ROWS","worksToSnapshot","works","rowCount","colCount","rawValues","w","row","snapshotToWorks","snapshot","raw","name","W_COL","unit","qty","price","costUnit","note","mergeSectionWorks","newWorks","result","replacing","t","sk","useActSheetAdapter","actId","onSaved","mode","setMode","useState","initialSnapshot","setInitialSnapshot","useEffect","i","act","getAct","currentItems","compat","anyR","updateAct","ACT_ALLOW_COLUMN_INSERT","LS_HIDE_COST","LS_EXPANDED_SECTIONS","ensureBaseStructure","hasSection","hasWork","extractSections","seen","ActEditorPage","id","useParams","navigate","useNavigate","loc","useLocation","goBack","useCallback","target","can","useAuth","validId","setAct","setItems","loading","setLoading","error","setError","hideCost","setHideCostState","expandedSections","setExpandedSections","viewMode","setViewMode","totalsBySection","setTotalsBySection","canWrite","lsGetJson","setHideCost","lsSetJson","loadAct","data","normalized","sections","prev","valid","s","sec","filtered","e","handleSectionExpand","next","handleSectionCollapse","useMemo","agg","worksSum","worksCost","Box","jsx","Button","ArrowBackIcon","Typography","totalSum","totalCost","totalProfit","marginPct","jsxs","Chip","Tooltip","FormControlLabel","Switch","_","formatUaMoney","Fragment","formatPercent","ActSectionAccordion","section","onItemsRefresh","expanded","onExpand","onCollapse","canEdit","onTotalsChange","configWithAutocomplete","worksSheetConfig","adapter","sectionTotals","setSectionTotals","React","handleTotalsChange","Accordion","isExp","AccordionSummary","ExpandLessIcon","ExpandMoreIcon","AccordionDetails","Sheet","SectionTotalsBlock","totals"],"mappings":"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"}