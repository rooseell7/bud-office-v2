---
description: "NAZAR RULES: персональні правила роботи агента в BUD_OFFICE. Пріоритет — стабільність, мінімальні дифи, українська мова, жодної самодіяльності."
globs:
  - "**/*"
alwaysApply: true
---

## 1) Мова та комунікація
- Вся комунікація ТІЛЬКИ українською.
- Пиши коротко і по суті: план → виконання → результат.
- Якщо щось неясно або є ризик регресу — STOP і запропонуй 2–3 варіанти з ризиками (без "винахідництва").

## 2) Режим роботи (рейки)
- Працюємо маленькими/точковими кроками: 1 логічна зміна = 1 маленький диф.
- Заборонено робити "комбайн" з багатьох змін за раз.
- Після кожного кроку — короткий звіт: CHANGES / CHECKS / RISK NOTES.

## 3) Заборона масових змін
- Заборонено робити масові/широкі зміни (масовий рефактор, масові перейменування, масове форматування, "почистити все").
- Якщо в ТЗ є вимога на масові зміни — ТИ МАЄШ запитати у мене підтвердження перед стартом і запропонувати план + ризики.

## 4) Нуль самодіяльності
- НЕ роби "покращень", "оптимізацій", "рефакторів", "оновлення залежностей" без прямого ТЗ.
- НЕ перейменовуй файли/папки, НЕ рухай структуру проєкту без прямого ТЗ.
- НЕ змінюй форматування файлів масово (тільки точкові зміни в місці задачі).

## 5) UI / Візуал
- Будь-які зміни UI/візуалу/кольорів/верстки/теми — ТІЛЬКИ якщо задача прямо про дизайн.
- Якщо задача не про дизайн — не торкайся стилів.

## 6) /sheet (критично)
- Будь-які зміни у /sheet (Frontend/src/sheet/**) дозволені ТІЛЬКИ:
  1) при конкретному ТЗ від мене,
  2) ТІЛЬКИ в межах цього ТЗ (не більше).
- Будь-які "покращення" в /sheet за власною ініціативою — ЗАБОРОНЕНО.
- Якщо задача торкається /sheet — STOP → короткий план, ризики, які файли зачепиш. Без самодіяльності.

## 7) Collab / ENV (критично)
- Не ламати dual-mode Local + Nginx (API/WS URL лише через існуючий env/resolver).
- Не змінювати протоколи/ops/snapshots/версії/WS-логіку без явного ТЗ.
- Якщо задача торкається collab/ENV — STOP → 2–3 варіанти рішення з ризиками.

## 8) Backend / DB / Permissions
- Не міняти DB schema / Entity / міграції / контракти API без явного ТЗ та узгодження з фронтом.
- Permissions/roles: source of truth — центральний файл permissions у бекенді (не плодити дублікати).
- Якщо треба новий permission — додати у центральний список і узгодити, які ролі його мають (без "на око").

## 9) Тести: нова фіча = новий тест + регресія
- Після додавання нових функцій ОБОВ'ЯЗКОВО додати новий тест, який:
  1) перевіряє, що все що працювало — працює (регресія),
  2) перевіряє, що нове — теж працює.
- Заборонено "лікувати" падіння тестів зміною тестів під зелений. Фікси — кодом.
- Якщо тестової інфраструктури немає або неясно де писати тест — STOP і запитай у мене (з варіантами).

## 10) Тести та "DONE"
- Перед будь-яким "DONE/готово" — діяти за DONE GATE (50-done-gate.mdc):
  або реально прогнати checks, або чітко написати "НЕ ПРОГНАНО" + RUN THESE CHECKS LOCALLY.

## 11) Формат фінального звіту (завжди)
- CHANGES: що саме змінено (файли/сутність)
- CHECKS RUN: що прогнано (або "НЕ ПРОГНАНО" + RUN THESE CHECKS LOCALLY)
- RISK NOTES: що ризикове / що не чіпав
